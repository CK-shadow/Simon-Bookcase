---
title: 插件
tags: 
 - Vue.js
categories: frontEnd
---

注册插件需要一个公开的方法install，它的第一个参数是Vue构造器，第二个参数是一个可选的选项对象。示例代码如下：
```js
MyPlugin.install = function (Vue, options) {
    // 全局注册组件（指令等功能资源类似）
    Vue.component('component-name', {
        // 组件内容
    }),
    // 添加实例方法
    Vue.prototype.$Notice = function () {
        // 逻辑 ...
    },
    // 添加全局方法或属性
    Vue.globalMethod = function () {
        // 逻辑 ...
    },
    // 添加全局混合
    Vue.mixin({
        mounted: function () {
            // 逻辑 ...
        }
    })
}
```
通过Vue.use()来使用插件：
```js
Vue.use(MyPlugin)
或
Vue.use(MyPlugin, {
    // 参数
})
```
绝大多数情况下，开发插件主要是通过NPM发布后给别人使用的，在自己的项目中可以直接在入口调用以上的方法，无须多一步注册和使用的步骤

## 前端路由与vue-router
### 什么是前端路由
前端路由，即由前端来维护一个路由规则。实现有两种，一种是利用url的hash，就是常说的锚点（#），JavaScript通过hashChange事件来监听url的改变，IE7及以下需要用轮询；另一种就是HTML5的history模式，它使url看起来像普通网站那样，以"/"分割，没有#，但页面并没有跳转，不过使用这种模式需要服务端支持，服务端在接收到所有的请求后，都指向同一个html文件，否则会出现404.因此，SPA只有一个html，整个网站的所有内容都在这一个html里，通过JavaScript来处理

### vue-router基本用法
新建一个目录Router，复制Demo代码并安装完成后，再通过NPM来安装vue-router
```
npm install --save vue-router
```
在main.js里使用Vue.use()加载插件
```js
import Vue from 'vue';
import App from './app.vue';
import VueRouter from 'vue-router';

Vue.use(VueRouter);
```
每个页面对应一个组件，也就是对应一个.vue文件。在Router目录下创建views目录，用于存放所有的页面然后在views里创建index.vue和about.vue两个文件
```vue
<!-- index.vue -->
<template>
    <div>首页</div>
</template>

<script>
    export default {
    }
</script>
```
```vue
<!-- about.vue -->
<template>
    <div>介绍页</div>
</template>

<script>
    export default {
    }
</script>
```
再回到main.js里，完成路由的剩余配置。创建一个数组来制定路由匹配列表，每一个路由映射一个组件
```js
const Routers = [
    {
        path: '/index',
        component: (resolve) => require(['./views/index.vue'], resolve)
    },
    {
        path: '/about',
        component: (resolve) => require(['./views/baout.vue'], resolve)
    }
];
```
Routers里的每一项path属性就是指定当前匹配的路径，component是映射的组件。上例的写法，webpack会把每一个路由都打包为一个js文件，在请求到该页面时，才去加载这个页面的js，也就是异步实现的懒加载（按需加载）。这样做的好处是不需要在打开首页的时候就把所有的页面内容全部加载进来，只在访问时才加载。如果非要一次性加载，可以这样写：
```js
{
    path: '/index',
    component: require('./views/index.vue')
}
```
然后继续在main.js里完成配置和路由实例
```js
const RouterConfig = {
    // 使用HTML5的history模式
    mode: 'history',
    routes: Routers
};

new Vue({
    el: '#app',
    router: router,
    render: h => {
        return h(App)
    }
});
```
在RouterConfig里，设置mode为history会开启HTML5的History路由模式，通过"/"设置路径。如果不设置mode，就会使用"#"来设置路径。开启History路由，在生产环境时服务端必须进行配置，讲所有路由都指向同一个html，或设置404页面为该html，否则刷新页面时会出现404

&emsp;  
webpack-dev-server也要配置下来支持History路由，在package.json中修改dev命令：
```json
"scripts": {
    "dev": "webpack-dev-server --open --history-api-fallback --config webpack.config.js"
}
```
增加了--history-api-fallback，所有的路由都会指向index.html

&emsp;  
配置好了这些，最后在根实例app.vue里添加一个路由视图router-view来挂载所有的路由组件
```vue
<template>
    <div>
        <router-view></router-view>
    </div>
</template>
<script>
    export default {

    }
</script>
```
运行网页时，router-view会根据当前路由动态渲染不同的页面组件。网页中一些公共部分，比如顶部的导航栏、侧边导航栏、底部的版权信息，这些也可以直接写在app.vue里，与router-view同级。路由切换时，切换的是router-view挂载的组件，其它的内容不会变化

&emsp;  
运行npm run dev启动服务，然后访问localhost:8080/index和localhost:8080/about就可以访问这两个页面了

&emsp;  
在路由列表里，可以在最后新加一项，当访问的路径不存在时，重定向到首页
```js
const Routers = [
    // ...
    {
        path: '*',
        redirect: '/index'
    }
];
```
这样直接访问localhost:8080，就跳转到了localhost:8080/index页面

&emsp;  
路由列表的path也可以带属性，比如“个人主页”场景，路由的一部分是固定的，一部分是动态的：/user/123456，其中用户id“123456”就是动态的，但它们路由到同一个页面，在这个页面里，期望获取这个id，然后请求相关数据。在路由里可以这样配置参数
```js
// main.js
const Router = [
    // ...
    {
        path: 'user/:id',
        component: (resolve) => require(['./views/user.vue'], resolve)
    }
]
```
```vue
// 在router/views目录下，新建user.vue文件
<template>
    <div>{{ $route.params.id }}</div>
</template>
<script>
    export default {
        mounted () {
            console.log(this.$route.params.id);
        }
    }
</script>
```
因为配置的路由是"/user/:id"，所以直接访问localhost:8080/user回重定向到index页面，需要带一个id才能跳转到user页面，比如localhost:8080/user/123456