---
title: IO多路复用
tags: 
 - IO
categories: frontEnd
---

### 进程的运行特征
1. 进程可以使用计算机的多核资源
2. 进程是计算机资源分配的最小单元
3. 进程之间的运行互不影响，相互独立
4. 每个进程拥有各自独立的空间，各自使用各自的空间内容
    
### 基于fork的进程创建
pid = os.fork()  
功能：创建新的进程  
返回值：整数，如果创建失败则会返回一个负数，如果成功，新进程得到0，原进程得到新进程的PID号  
总结：  
* 子进程会复制父进程的全部内存空间，从fork的下一句开始执行
* 父子进程各自运行互不影响，顺序不确定
* 利用父子进程中fork返回值的差异，配合if语句让父子进程执行不同内容几乎是固定搭配
* 父进程fork之前开辟的空间，子进程也会拥有，父子进程在各自空间内操作互不影响
* 父子进程有各自特有内容，PID，PCB，...
            
### 进程相关函数
```python
os.getpid()
    功能：获取一个进程的PID值
    返回值：返回当前进程的PID值

os.getppid()
    功能：返回父进程的PID号
    返回值：父进程PID值

os._exit(status)
    功能：结束一个进程
    参数：进程结束状态，整数

sys.exit([status])
    功能：结束一个进程
    参数：默认为0，整数表示退出状态，字符串表示退出时打印内容
```
        
### 孤儿和僵尸
孤儿进程：父进程先于子进程退出，此时子进程成为孤儿进程  
特点：孤儿进程会被系统进程收养，此时系统进程会成为孤儿进程新的父进程，孤儿进程退出时，系统进程会处理退出行为

僵尸进程：子进程先于父进程退出，父进程没有处理子进程退出行为，此时子进程就会成为僵尸进程  
特点：僵尸进程虽然已经结束，但是会存留部分进程信息在内存中，大量的僵尸进程会浪费系统内存
    
**僵尸进程处理**  
1. 使用wait()函数处理子进程退出
```python
pid, status = os.wait()
    功能：阻塞等待子进程退出
    返回值：pid 退出的子进程pid值    status 子进程的退出状态
            
pid,status = os.waitpid(pid,option)
    功能： 阻塞等待子进程退出
    参数： pid   -1 等待任意子进程退出
            	>0 表示等待指定子进程
           option  0  表示阻塞   
                    os.WNOHANG 表示非阻塞
    返回值： pid  退出的子进程PID
            status 子进程的退出状态
```

2. 创建二级子进程
    * 父进程创建子进程wait等待回收
    * 子进程创建二级子进程后退出
    * 二级子进程成为孤儿，和父进程一起完成事件
        
3. 信号处理
    * 原理：子进程退出会发送信号给父进程，如果父进程忽略子进程信号，则系统会自动处理子进程退出
    * 方法：signal.signal(signal.SIGCHLD,signal.SIG_IGN)
    * 特点：非阻塞，使用该方法，可以处理所有子进程退出          

