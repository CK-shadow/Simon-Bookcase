---
title: 线程
tags: 
 - Thread
categories: frontEnd
---

### 线程编程
**线程** 
* 线程被称为轻量级的进程
* 线程也是多任务编程方法
* 线程是系统分配内核的最小单元
* 线程可以理解为进程中的任务分支程序
        
**线程特征**
* 一个进程可以包含多个线程
* 线程也是一个运算过程，消耗计算机资源
* 一个进程中的所有线程共享这个进程资源
* 多个线程运行互不影响，各自执行
* 线程的创建和销毁消耗资源远小于进程
* 线程也有自己的特有属性特征命令集，id等
        
**threading模块创建线程**  
```python
创建线程对象
    t = Thread()
    功能：创建线程对象
    参数：target 绑定的线程函数
          arges元组 给线程函数位置传参
          kwargs 字典 给线程函数关键字字典传参
        
启动线程
    t.start()
        
阻塞等待回收线程
    t.join([timeout])
```
            
**线程对象属性**  
t.name&emsp;线程名称  
t.setName()&emsp;设置线程名称  
t.getName()&emsp;获取线程名称  
t.is_alive()&emsp;查看线程是否在生命周期  
t.daemon()&emsp;设置主线程和分支线程的退出关系  
t.setDaemon()&emsp;设置daemon属性值  
t.isDaemon()&emsp;查看daemon属性值
::: tip
设置daemon属性值为True时，此时主线程退出分支线程也会退出，设置在start之前，不可与join同用
:::
        
**自定义线程类**  
* 创建步骤
  1. 继承Thread类
  2. 重写init方法添加自己的属性，执行父类init
  3. 重写run方法
* 使用
  1. 实例化对象
  2. 调用start自动执行run
  3. join回收线程
            
### 线程通信
**通信方法**  
线程间使用全局变量进行通信
        
**共享资源的争夺**  
共享资源：多个进程和线程都可以操作的资源称为共享资源  
影响：对共享资源的无需操作可能会带来数据的混乱或操作错误，此时需要同步互斥机制处理
        
**同步互斥机制**  
同步：同步是一种协作关系，为完成操作，多进程或线程间形成一种协调，按照必要的步骤操作  
互斥：互斥是一种制约关系，当一个进程或者线程抢占到资源时进行加锁处理，其他进程线程需等解锁后才能护理
        
**线程互斥方法**  
```python
线程Event 
    e = Event()  创建Event对象
    e.wait([timeout])  阻塞等待直至线程被set
    e.set()  设置e，使wait结束阻塞
    e.clear()  清除e的设置，wait会阻塞
    e.is_set()  判断e的状态
同步互斥方法Lock
    lock = Lock()    创建锁
    lock.acquire()   上锁  如果lock已经上锁会阻塞
    lock.release()   解锁 
    with  lock:   上锁
        ...
    with 代码块结束自动解锁
```
            
### python线程的GIL问题
效率：在无阻塞的情况下，多线程运行效率与单线程几乎相近，而多进程可有效的提高程序运行效率
    
**python的GIL问题**  
* GIL：由于python解释器设计中加入了全局解释器锁，导致python解释器只能解释一个线程，降低了python执行效率
* 后果：因遇到阻塞解释器会主动让出解释器，所以python在高延迟、多阻塞的情况下可提高运行效率，其它情况不适合
* 问题建议：
    1. 修改c解释器
    2. 尽量使用进程并发
    3. 不用c作为解释器
            
### 进程和线程的区别联系
**区别联系**
1. 两者都是多任务编程方式，都能使用计算机多核资源
2. 进程创建和删除消耗的资源比线程多
3. 进程空间独立，数据互不干扰，有专门的通信方法，线程使用全局变量通信
4. 一个进程可包含多个线程，二者存在包含关系
5. 多线程共享进程资源，对共享资源操作时往往需要同步互斥处理
6. 进程线程都是运行过程描述，有自己的属性标志
        
**应用场景**
1. 任务场景： 如果是相对独立的任务模块可能使用进程，如果是多个分支共同构成一个完整功能可能用线程
2. 项目结构：多种语言实现不同任务模块可能是多进程。
3. 语言特点：比如Java一些语言实现线程资源少效率高，Python有GIL 等
4. 难易程度： 通信难度，逻辑处理难度等考量       

