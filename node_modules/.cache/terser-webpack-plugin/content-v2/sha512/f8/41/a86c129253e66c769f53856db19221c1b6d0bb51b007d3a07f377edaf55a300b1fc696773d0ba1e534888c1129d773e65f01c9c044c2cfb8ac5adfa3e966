{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{688:function(s,e,n){\"use strict\";n.r(e);var a=n(0),t=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[n(\"h3\",{attrs:{id:\"并发登录控制配置（spring-config-shiro-xml）\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#并发登录控制配置（spring-config-shiro-xml）\"}},[s._v(\"#\")]),s._v(\" 并发登录控制配置（spring-config-shiro.xml）\")]),s._v(\" \"),n(\"div\",{staticClass:\"language- line-numbers-mode\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[n(\"code\",[s._v('<bean id=\"kickoutSessionControlFilter\" \\nclass=\"com.simon.web.shiro.filter.KickoutSessionControlFilter\">\\n    <property name=\"cacheManager\" ref=\"cacheManager\"/>\\n    <property name=\"sessionManager\" ref=\"sessionManager\"/>\\n    <property name=\"kickoutAfter\" value=\"false\"/>\\n    <property name=\"maxSession\" value=\"2\"/>\\n    <property name=\"kickoutUrl\" value=\"/login?kickout=1\"/>\\n</bean>\\n')])]),s._v(\" \"),n(\"div\",{staticClass:\"line-numbers-wrapper\"},[n(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),n(\"br\")])]),n(\"ul\",[n(\"li\",[s._v(\"cacheManager：使用cacheManager获取响应的cache来缓存用户登录的会话，用于保存用户-会话之间关系的\")]),s._v(\" \"),n(\"li\",[s._v(\"sessionManager：用于根据会话ID，获取会话进行踢出操作\")]),s._v(\" \"),n(\"li\",[s._v(\"kickoutAfter：是否提出后来登录的，默认是false，即后登录用户踢出前登录用户\")]),s._v(\" \"),n(\"li\",[s._v(\"maxSession：同一个用户的最大会话数，默认1\")]),s._v(\" \"),n(\"li\",[s._v(\"kickoutUrl：被踢出后重定向到的地址\")])]),s._v(\" \"),n(\"h3\",{attrs:{id:\"shiro-filter配置\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#shiro-filter配置\"}},[s._v(\"#\")]),s._v(\" Shiro-Filter配置\")]),s._v(\" \"),n(\"div\",{staticClass:\"language- line-numbers-mode\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[n(\"code\",[s._v('<bean id=\"shiroFilter\" class=\"org.apache.shiro.spring.web.ShiroFilterFactoryBean\">\\n    <property name=\"securityManager\" ref=\"securityManager\"/>\\n    <property name=\"loginUrl\" value=\"/login\"/>\\n    <property name=\"filters\">\\n        <util:map>\\n            <entry key=\"authc\" value-ref=\"formAuthenticationFilter\"/>\\n            <entry key=\"sysUser\" value-ref=\"sysUserFilter\"/>\\n            <entry key=\"kickout\" value-ref=\"kickoutSessionControlFilter\"/>\\n        </util:map>\\n    </property>\\n    <property name=\"filterChainDefinitions\">\\n        <value>\\n            /login = authc\\n            /logout = logout\\n            /authenticated = authc\\n            /** = kickout,user,sysUser\\n        </value>\\n    </property>\\n</bean>\\n')])]),s._v(\" \"),n(\"div\",{staticClass:\"line-numbers-wrapper\"},[n(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),n(\"br\")])]),n(\"h3\",{attrs:{id:\"kickoutsessioncontrolfilter核心代码\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#kickoutsessioncontrolfilter核心代码\"}},[s._v(\"#\")]),s._v(\" KickoutSessionControlFilter核心代码\")]),s._v(\" \"),n(\"div\",{staticClass:\"language- line-numbers-mode\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[n(\"code\",[s._v('protected boolean onAccessDenied(ServletRequest request, ServletResponse response) throws Exception {\\n    Subject subject = getSubject(request, response);\\n    if(!subject.isAuthenticated() && !subject.isRemembered()) {\\n        //如果没有登录，直接进行之后的流程\\n        return true;\\n    }\\n    Session session = subject.getSession();\\n    String username = (String) subject.getPrincipal();\\n    Serializable sessionId = session.getId();\\n    //TODO 同步控制\\n    Deque<Serializable> deque = cache.get(username);\\n    if(deque == null) {\\n        deque = new LinkedList<Serializable>();\\n        cache.put(username, deque);\\n    }\\n    //如果队列里没有此sessionId，且用户没有被踢出；放入队列\\n    if(!deque.contains(sessionId) && session.getAttribute(\"kickout\") == null) {\\n        deque.push(sessionId);\\n    }\\n    //如果队列里的sessionId数超出最大会话数，开始踢人\\n    while(deque.size() > maxSession) {\\n        Serializable kickoutSessionId = null;\\n        if(kickoutAfter) { //如果踢出后者\\n            kickoutSessionId = deque.removeFirst();\\n        } else { //否则踢出前者\\n            kickoutSessionId = deque.removeLast();\\n        }\\n        try {\\n            Session kickoutSession =\\n                sessionManager.getSession(new DefaultSessionKey(kickoutSessionId));\\n            if(kickoutSession != null) {\\n                //设置会话的kickout属性表示踢出了\\n                kickoutSession.setAttribute(\"kickout\", true);\\n            }\\n        } catch (Exception e) {//ignore exception\\n        }\\n    }\\n    //如果被踢出了，直接退出，重定向到踢出后的地址\\n    if (session.getAttribute(\"kickout\") != null) {\\n        //会话被踢出了\\n        try {\\n            subject.logout();\\n        } catch (Exception e) { //ignore\\n        }\\n        saveRequest(request);\\n        WebUtils.issueRedirect(request, response, kickoutUrl);\\n        return false;\\n    }\\n    return true;\\n}\\n')])]),s._v(\" \"),n(\"div\",{staticClass:\"line-numbers-wrapper\"},[n(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"29\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"30\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"31\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"32\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"33\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"34\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"35\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"36\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"37\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"38\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"39\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"40\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"41\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"42\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"43\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"44\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"45\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"46\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"47\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"48\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"49\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"50\")]),n(\"br\")])])])}),[],!1,null,null,null);e.default=t.exports}}]);","extractedComments":[]}